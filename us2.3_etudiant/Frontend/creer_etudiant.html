<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cr√©er un √©tudiant - Plateforme P√©dagogique</title>
    <link rel="stylesheet" href="./css/styleus2.3.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* Correction temporaire pour le pattern d'email */
        input[pattern]:invalid {
            border-color: #dc2626;
        }
        input[pattern]:valid {
            border-color: #16a34a;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header avec navigation -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Plateforme P√©dagogique</span>
                </div>
                <nav class="nav">
                    <a href="../../directeur/frontend/dashboard.html" class="nav-link">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                    <a href="#" class="nav-link active">
                        <i class="fas fa-user-plus"></i> Cr√©er √âtudiant
                    </a>
                </nav>
            </div>
        </header>

        <!-- Carte principale -->
        <main class="main-content">
            <div class="card">
                <!-- En-t√™te de la carte -->
                <div class="card-header">
                    <h1><i class="fas fa-user-graduate"></i> Cr√©er un nouvel √©tudiant</h1>
                    <p class="subtitle">Remplissez le formulaire pour inscrire un √©tudiant dans une promotion</p>
                </div>

                <!-- Formulaire -->
                <form id="formEtudiant" class="form">
                    <!-- Section Informations personnelles -->
                    <fieldset class="form-section">
                        <legend class="section-title">
                            <i class="fas fa-id-card"></i> Informations personnelles
                        </legend>
                        
                        <div class="form-grid">
                            <!-- Champ Nom -->
                            <div class="form-group">
                                <label for="nom" class="form-label">
                                    <i class="fas fa-user"></i> Nom *
                                </label>
                                <div class="input-group">
                                    <input type="text" 
                                           id="nom" 
                                           name="nom" 
                                           class="form-input"
                                           placeholder="Ex: Dupont"
                                           required
                                           minlength="2"
                                           maxlength="100">
                                    <div class="input-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </div>
                                <div class="form-hint">
                                    Minimum 2 caract√®res, maximum 100 caract√®res
                                </div>
                                <div class="error-message" id="error-nom"></div>
                            </div>

                            <!-- Champ Pr√©nom -->
                            <div class="form-group">
                                <label for="prenom" class="form-label">
                                    <i class="fas fa-user"></i> Pr√©nom *
                                </label>
                                <div class="input-group">
                                    <input type="text" 
                                           id="prenom" 
                                           name="prenom" 
                                           class="form-input"
                                           placeholder="Ex: Jean"
                                           required
                                           minlength="2"
                                           maxlength="100">
                                    <div class="input-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                </div>
                                <div class="form-hint">
                                    Minimum 2 caract√®res, maximum 100 caract√®res
                                </div>
                                <div class="error-message" id="error-prenom"></div>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Section Contact -->
                    <fieldset class="form-section">
                        <legend class="section-title">
                            <i class="fas fa-envelope"></i> Informations de contact
                        </legend>
                        
                        <div class="form-group">
                            <label for="email" class="form-label">
                                <i class="fas fa-at"></i> Adresse email *
                            </label>
                            <div class="input-group">
                                <input type="email" 
                                       id="email" 
                                       name="email" 
                                       class="form-input"
                                       placeholder="exemple@email.com"
                                       required>
                                       <!-- Pattern simplifi√© pour √©viter l'erreur -->
                                <div class="input-icon">
                                    <i class="fas fa-envelope"></i>
                                </div>
                            </div>
                            <div class="form-hint">
                                Cette adresse servira d'identifiant de connexion
                            </div>
                            <div class="error-message" id="error-email"></div>
                        </div>
                    </fieldset>

                    <!-- Section Promotion -->
                    <fieldset class="form-section">
                        <legend class="section-title">
                            <i class="fas fa-users"></i> Affectation √† une promotion
                        </legend>
                        
                        <div class="form-group">
                            <label for="promotion_id" class="form-label">
                                <i class="fas fa-layer-group"></i> Promotion *
                            </label>
                            <div class="input-group">
                                <select id="promotion_id" 
                                        name="promotion_id" 
                                        class="form-select"
                                        required>
                                    <option value="">Chargement des promotions...</option>
                                </select>
                                <div class="input-icon">
                                    <i class="fas fa-chevron-down"></i>
                                </div>
                            </div>
                            <div class="form-hint">
                                S√©lectionnez la promotion dans laquelle inscrire l'√©tudiant
                            </div>
                            <div class="error-message" id="error-promotion"></div>
                        </div>

                        <!-- Informations promotion -->
                        <div id="promotion-info" class="info-box" style="display: none;">
                            <i class="fas fa-info-circle"></i>
                            <div>
                                <strong>Promotion s√©lectionn√©e :</strong>
                                <span id="selected-promotion-name">-</span>
                                <br>
                                <small>Ann√©e acad√©mique : <span id="selected-promotion-year">-</span></small>
                            </div>
                        </div>
                    </fieldset>

                    <!-- Section Actions -->
                    <div class="form-actions">
                        <button type="button" id="btnReset" class="btn btn-secondary">
                            <i class="fas fa-redo"></i> R√©initialiser
                        </button>
                        
                        <button type="submit" id="btnSubmit" class="btn btn-primary">
                            <i class="fas fa-user-plus"></i> Cr√©er l'√©tudiant
                        </button>
                    </div>
                </form>

                <!-- Messages syst√®me -->
                <div id="message" class="message-box"></div>

                <!-- R√©sum√© cr√©ation r√©ussie (cach√© par d√©faut) -->
                <div id="success-summary" class="success-summary" style="display: none;">
                    <h3><i class="fas fa-check-circle"></i> √âtudiant cr√©√© avec succ√®s</h3>
                    <div class="summary-content">
                        <p><strong>Identifiants g√©n√©r√©s :</strong></p>
                        <div class="credentials">
                            <div class="credential-item">
                                <span class="label">Email :</span>
                                <span id="summary-email" class="value">-</span>
                            </div>
                            <div class="credential-item">
                                <span class="label">Mot de passe temporaire :</span>
                                <span id="summary-password" class="value">-</span>
                            </div>
                            <div class="credential-item">
                                <span class="label">Promotion :</span>
                                <span id="summary-promotion" class="value">-</span>
                            </div>
                        </div>
                        <div class="warning-box">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Important : Ces identifiants doivent √™tre communiqu√©s √† l'√©tudiant</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pied de page -->
            <footer class="footer">
                <p>¬© 2024 Plateforme P√©dagogique - Tous droits r√©serv√©s</p>
                <p class="version">Version 1.0.0</p>
            </footer>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/etudient.js"></script>
    
    <!-- Script de d√©bogage et correction -->
    <script>
    // Correction de l'initialisation
    document.addEventListener('DOMContentLoaded', function() {
        console.log('‚úÖ DOM charg√© - Initialisation corrig√©e');
        
        // Ajouter un ID au formulaire pour √™tre s√ªr qu'il est accessible
        const form = document.getElementById('formEtudiant');
        if (form) {
            console.log('‚úÖ Formulaire trouv√© avec ID:', form.id);
            
            // Ajouter un attribut data pour le d√©bogage
            form.dataset.debug = 'true';
        } else {
            console.error('‚ùå Formulaire NON trouv√©!');
        }
        
        // Tester la r√©cup√©ration des valeurs des champs
        function testFieldValues() {
            console.log('=== TEST VALEURS CHAMPS ===');
            const fields = ['nom', 'prenom', 'email', 'promotion_id'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                console.log(`${fieldId}:`, field ? `trouv√©, valeur="${field.value}"` : 'NON TROUV√â');
            });
            console.log('=== FIN TEST ===');
        }
        
        // Ex√©cuter le test apr√®s un d√©lai
        setTimeout(testFieldValues, 500);
        
        // Tester l'API de promotions
        async function testPromotionsAPI() {
            console.log('=== TEST API PROMOTIONS ===');
            try {
                const response = await fetch('../backend/get_promotions.php');
                console.log('Status:', response.status);
                
                const data = await response.json();
                console.log('Donn√©es:', data);
                
                if (data.success) {
                    console.log(`‚úÖ ${data.promotions.length} promotions charg√©es`);
                }
            } catch (error) {
                console.error('‚ùå Erreur API:', error);
            }
        }
        
        // Ex√©cuter le test API
        setTimeout(testPromotionsAPI, 1000);
        
        // Ajouter un gestionnaire manuel pour le formulaire (solution de secours)
        form.addEventListener('submit', async function(e) {
            e.preventDefault();
            console.log('üì® Soumission MANUELLE du formulaire');
            
            // R√©cup√©rer les valeurs directement
            const data = {
                nom: document.getElementById('nom').value.trim(),
                prenom: document.getElementById('prenom').value.trim(),
                email: document.getElementById('email').value.trim(),
                promotion_id: document.getElementById('promotion_id').value
            };
            
            console.log('Donn√©es r√©cup√©r√©es manuellement:', data);
            
            // Valider que les donn√©es ne sont pas vides
            if (!data.nom || !data.prenom || !data.email || !data.promotion_id) {
                console.error('‚ùå Donn√©es manquantes:', data);
                alert('Veuillez remplir tous les champs');
                return;
            }
            
            // D√©sactiver le bouton
            const submitBtn = document.getElementById('btnSubmit');
            const originalText = submitBtn.innerHTML;
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Envoi...';
            
            try {
                // Cr√©er les param√®tres URL
                const params = new URLSearchParams();
                params.append('nom', data.nom);
                params.append('prenom', data.prenom);
                params.append('email', data.email);
                params.append('promotion_id', data.promotion_id);
                
                console.log('Param√®tres envoy√©s:', params.toString());
                
                // Envoyer la requ√™te
                const response = await fetch('../backend/creer_etudiant.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: params
                });
                
                console.log('R√©ponse status:', response.status);
                const result = await response.json();
                console.log('R√©sultat:', result);
                
                // Afficher le r√©sultat
                const messageBox = document.getElementById('message');
                if (messageBox) {
                    messageBox.textContent = result.message;
                    messageBox.className = result.success ? 'message-box success' : 'message-box error';
                    messageBox.style.display = 'block';
                }
                
                if (result.success) {
                    // R√©initialiser le formulaire apr√®s 3 secondes
                    setTimeout(() => {
                        form.reset();
                        if (messageBox) {
                            messageBox.style.display = 'none';
                        }
                    }, 3000);
                }
                
            } catch (error) {
                console.error('‚ùå Erreur:', error);
                const messageBox = document.getElementById('message');
                if (messageBox) {
                    messageBox.textContent = 'Erreur de connexion au serveur';
                    messageBox.className = 'message-box error';
                    messageBox.style.display = 'block';
                }
            } finally {
                // R√©activer le bouton
                submitBtn.disabled = false;
                submitBtn.innerHTML = originalText;
            }
        });
        
        console.log('‚úÖ Gestionnaire manuel ajout√© au formulaire');
    });
    
    // Fonction pour tester rapidement depuis la console
    window.testSubmit = async function(testData = null) {
        console.log('üß™ TEST MANUEL SUBMIT');
        
        const data = testData || {
            nom: 'Acakpo',
            prenom: 'Thibaut',
            email: 'test_' + Date.now() + '@test.com',
            promotion_id: '1'
        };
        
        console.log('Donn√©es:', data);
        
        const params = new URLSearchParams();
        params.append('nom', data.nom);
        params.append('prenom', data.prenom);
        params.append('email', data.email);
        params.append('promotion_id', data.promotion_id);
        
        console.log('Params:', params.toString());
        
        try {
            const response = await fetch('../backend/creer_etudiant.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: params
            });
            
            const result = await response.json();
            console.log('R√©sultat:', result);
            return result;
            
        } catch (error) {
            console.error('Erreur:', error);
            return null;
        }
    };
    
    // Fonction pour afficher les valeurs actuelles du formulaire
    window.showFormValues = function() {
        const values = {
            nom: document.getElementById('nom')?.value || 'VIDE',
            prenom: document.getElementById('prenom')?.value || 'VIDE',
            email: document.getElementById('email')?.value || 'VIDE',
            promotion_id: document.getElementById('promotion_id')?.value || 'VIDE'
        };
        console.log('Valeurs du formulaire:', values);
        return values;
    };
    
    console.log('‚úÖ Scripts de d√©bogage charg√©s');
    </script>
</body>
</html>